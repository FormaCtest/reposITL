{"version":3,"file":"edit.c12994d5.js","sources":["../../../../pages/[name].itl.wiki/section/[id_section]/edit.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        \r\n        <ErrorAdd v-show=\"error\" :top=\"0\" :alert=\"alert\"/>\r\n        <div :class=\"[{'heads': true},{'eRror':error}]\">\r\n            <ListSection @list=\"info\" @click=\"vis_select=false;\" v-show=\"vis_select\" @selected=\"get_parent\" :left=\"230\" :left_arrw=\"20\" :top=\"130\"/>\r\n            <div @click=\"vis_ch=vis_ch?false:true\" class=\"chg\"><img src=\"@/assets/resourses/icons/chain.png\"><span>Поделиться</span></div>\r\n            <SHaRM :type_entity=\"2\" :id_entity=\"sect.current_section\" v-show=\"vis_ch\" :top=\"60\" :left=\"500\" :left_arrw=\"60\"/>\r\n            <div class=\"RR liz\" @click=\"vis_select=vis_select?false:true;\"><input type=\"text\" :value=\"link_section\" readonly></div>\r\n            <ChangingAccess :del=\"true\" @click=\"vis_ch=false\" :type_entity=\"2\" :id_entity=\"sect.current_section\" :text=\"'Доступ'\" :width_input=\"80\" :width_img=\"14\" :height_img=\"15\" @For_whom=\"get_per\" :left=\"5\" :left_window=\"430\" :left_arrw=\"5\" :top= \"18\"/>\r\n            <input class=\"HH\" v-model=\"h_sec\" type=\"text\" placeholder=\"Заголовок раздела\">\r\n            <button @click=\"test_save\" class=\"OP\">Сохранить раздел</button>\r\n            <button @click=\" navigateTo('/'+teams.session_TeamCode+'.itl.wiki/section/'+sect.current_section)\" class=\"OT\">Отменить</button>\r\n            <div id=\"editorjs\"></div>\r\n        </div>\r\n       \r\n    </div>\r\n</template>\r\n<script>\r\nimport { useSectionStore } from '~~/stores/SectionStore';\r\nimport { useThePrivateStore } from '~~/stores/private';\r\nimport { useTeamsStore } from '~~/stores/Teams';\r\nimport { useDataUserStore } from '~~/stores/UserData';\r\n import EditorJs from '@editorjs/editorjs'\r\n//  import Header from '@editorjs/header'; \r\n//  import List from '@editorjs/list';\r\n//  import ImageTool from '@editorjs/image';\r\n//  import Table from '@editorjs/table';\r\n//  import Quote from '@editorjs/quote';\r\n//  import CodeTool from '@editorjs/code';\r\n//  import Delimiter from '@editorjs/delimiter';\r\n//  import RawTool from '@editorjs/raw';\r\n//  import Warning from '@editorjs/warning';\r\n//  import Checklist from '@editorjs/checklist';\r\n definePageMeta ({\r\n  middleware: ['auth', 'team'],\r\n})\r\nexport default {\r\n\r\nsetup(){\r\n    const priv = useThePrivateStore()\r\n    const teams = useTeamsStore()\r\n    const user = useDataUserStore()\r\n    const sect = useSectionStore()\r\n    const editor = new EditorJs({\r\n    holder: 'editorjs', \r\n    data: {\"time\" : 1550476186479,\r\n    \"blocks\" : [{\"id\": \"save\", \"type\": \"paragraph\", \"data\": {\"text\": '' } }],\r\n    \"version\" : \"2.8.1\"},\r\n    onReady: ()=>{\r\n        import_data()\r\n   \r\n},\r\nonChange:() =>{\r\n    \r\n}\r\n})\r\nfunction datys(text){\r\n    editor.blocks.render({\"time\" : 1550476186479,\r\n    \"blocks\" : [{\"id\": \"save\", \"type\": \"paragraph\", \"data\": {\"text\": text } }],\r\n    \"version\" : \"2.8.1\"})\r\n   \r\n}\r\n    async function import_data(){\r\n        const url = new URL(\r\n    \"https://api.wiki.itl.systems/team/section/edit\"\r\n);\r\n\r\nconst params = {\r\n    \"team_id\": teams.session_TeamID,\r\n    \"section_id\": sect.current_section\r\n};\r\nObject.keys(params)\r\n    .forEach(key => url.searchParams.append(key, params[key]));\r\n \r\nconst headers = {\r\n    \"Authorization\": \"Bearer \"+priv.token,\r\n    \"Content-Type\": \"application/json\",\r\n    \"Accept\": \"application/json\",\r\n};\r\n\r\n\r\nawait useFetch(url, {\r\n    method: \"GET\",\r\n    headers,\r\n}).then(r=>{datys(r.data.value.data.section.content)})\r\n    }\r\n\r\nreturn {editor, priv, teams, user, sect, import_data}\r\n},\r\ndata(){\r\n    return{\r\n    h_sec: this.sect.current_name,\r\n    uSer: '',\r\n    permission: '',\r\n    parent: '',\r\n    vis_select: false,\r\n    link_section: 'Выберите раздел',\r\n    error: false,\r\n    block: false,\r\n    alert: '',\r\n    vis_ch: false\r\n    }\r\n},\r\n\r\n\r\nmethods:{\r\n    async delet(){\r\n        const url = new URL(\r\n    \"https://api.wiki.itl.systems/team/section/delete\"\r\n);\r\n\r\nconst headers = {\r\n    \"Authorization\": \"Bearer \"+this.priv.token,\r\n    \"Content-Type\": \"application/json\",\r\n    \"Accept\": \"application/json\",\r\n};\r\n\r\nlet body = {\r\n    \"section_id\": this.parent,\r\n    \"team_id\": this.teams.session_TeamID\r\n};\r\n   const {data, error} = await useFetch(url, {\r\n    method: \"POST\",\r\n    headers,\r\n    body: JSON.stringify(body),\r\n})\r\nif(!data.value){\r\n    switch (error.value.statusCode) {\r\n    case 401: throw createError({ statusCode: 401, statusMessage: 'the session is over', fatal: true })\r\n    break;\r\n    case 500: throw createError({ statusCode: 500, statusMessage: 'invalid request', fatal: true })\r\n    break;\r\n    case 400: throw createError({ statusCode: 400, statusMessage: 'Запросу не хватает данных'})\r\n    break;\r\n    case 429: this.priv.Delete_token;\r\n              throw createError({ statusCode: 400, statusMessage: 'Слишком много запросов', fatal: true})\r\n              break;\r\n}\r\n}\r\n},\r\n    get_per(act, id){\r\n    this.uSer=id;\r\n    this.permission=act\r\n    },\r\n    info(list){\r\n     this.link_section=list\r\n    },\r\n    get_parent(id, name, block){\r\n        if (block){\r\n            this.block=true\r\n        }\r\n    this.parent=id\r\n    if(typeof name ==='object'){\r\n    for (let a = 0; a<=name.length; a++){\r\n        if (a===0) {this.link_section=''; this.link_section+=name[a]}\r\n        else {\r\n            if(name[a]!==undefined) this.link_section+=\"/\"+name[a];\r\n        }\r\n    }\r\n    }else{this.link_section=name}\r\n    },\r\n     test_save(){\r\n        if(this.h_sec!='') {\r\n            if (!this.block) {\r\n                this.editor.save().then((outputData) => {\r\n   this.sect.Edit_section(this.permission, this.uSer, outputData, this.h_sec, this.parent)\r\n}).catch((error) => {\r\n console.log('Ошибка сохранения EditorJS: ', error)\r\n});\r\n            }else{\r\n                this.error=true;\r\n            this.alert=\"Выбранный раздел не доступен\";\r\n            }\r\n           \r\n        }else {\r\n            this.error=true;\r\n            this.alert=\"Вы не ввели название!\";\r\n        }\r\n\r\n}\r\n}}\r\n\r\n\r\n</script>\r\n<style lang=\"scss\" score>\r\n@import \"@/assets/scss/font_family.scss\";\r\n.ce-inline-tool--active{\r\n    color: rgb(51, 51, 216);\r\n}\r\n#editorjs{\r\n    position: relative;\r\n    left: 0%;\r\n    top: 200px;\r\n    padding: 0px;\r\n    width: 1120px;\r\n    color: #383838;\r\n    font-family: 'Roboto_regular';\r\n    font-size: 14px;\r\n}\r\n\r\n.heads{\r\n    position: relative;\r\n    width: 80%;\r\n    height: 180px;\r\n    padding: 0px;\r\n    margin: 0px;\r\n    left: 0%;\r\n    top: 0%;\r\n}\r\n.liz{\r\n    position: relative;\r\n    width: 120px;\r\n    height: 20px;\r\n    top: 100px;\r\n    left: 230px;\r\n}\r\n.chg{\r\n    cursor: pointer;\r\n    width: 120px;\r\n    font-family: 'Roboto_regular';\r\n    color: rgb(75, 75, 75);\r\n    font-size: 14px;;\r\n    position: absolute;\r\n    left: 140px;\r\n    top: 23px; \r\n    img{\r\n        position: relative;\r\n        top: 4px;\r\n        width: 18px;\r\n        height: 18px;;\r\n    }\r\n    span{\r\n        position: relative;\r\n        left: 10px;\r\n    }\r\n}\r\n.HH{\r\n    position: absolute;\r\n    left: 230px;\r\n    top: 140px;\r\n    padding: 0px;\r\n    margin: 0px;\r\n    outline:none;\r\n    font-size: 24px;\r\n    font-family: \"Roboto_regular\";\r\n    border: 0px;\r\n    background-color: white;\r\n    color: black;\r\n}\r\n.RR{\r\n    input{\r\n        position: absolute;\r\n    padding: 0px;\r\n    width: 100%;\r\n    margin: 0px;\r\n    outline:none;\r\n    font-size: 14px;\r\n    font-family: \"Roboto_regular\";\r\n    border: 0px;\r\n    color: #6d6d6d;\r\n    transition: 0.2s;\r\n    background-color: white;\r\n    cursor: pointer;\r\n    &:hover{\r\n        color: rgb(51, 51, 216);\r\n    }\r\n    }\r\n   \r\n}\r\n.aces{\r\n    position: absolute;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    width: 80px;\r\n    left: 77px;\r\n    top: 27px;\r\n    transition: 0.3s;\r\n    cursor: pointer;\r\n        &:hover{\r\n            span{\r\n                transition: 0.3s;\r\n            color: rgb(51, 51, 216);\r\n            }\r\n        }\r\n    span{\r\n        color:#383838;\r\n        font-family: 'Roboto_regular';\r\n        font-size: 14px;\r\n        \r\n    }\r\n}\r\n.tag{\r\n    cursor: pointer;\r\n    position: absolute;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    width: 60px;\r\n    left: 150px;\r\n    top: 25px;\r\n    transition: 0.3s;\r\n        &:hover{\r\n            span{\r\n                transition: 0.3s;\r\n            color: rgb(51, 51, 216);\r\n            }\r\n        }\r\n    span{\r\n        cursor: pointer;\r\n        color:#383838;\r\n        font-family: 'Roboto_regular';\r\n        font-size: 14px;\r\n        \r\n    }\r\n    img{\r\n        height: 15px;\r\n    }\r\n}\r\n.OP{\r\n    position: absolute;\r\n    top: 17px;\r\n    left: 1050px;\r\n    border-radius: 2px;\r\n    background-color: #0e65dd;\r\n    color: white;\r\n    font-size: 14px;\r\n    font-family: 'Roboto_regular';\r\n    cursor: pointer;\r\n    width: 140px;\r\n    height: 35px;\r\n    border: 0px;\r\n    margin: 0px;\r\n    transition: 0.3s;\r\n    padding: 0px;\r\n    &:hover{\r\n        background-color: #0d55b9;\r\n    }\r\n}\r\n.OT{\r\n    position: absolute;\r\n    top: 17px;\r\n    left: 1200px;\r\n    border-radius: 2px;\r\n    background-color: rgba(14,101,221,.04);\r\n    color: #0b55bb;\r\n    font-size: 14px;\r\n    font-family: 'Roboto_regular';\r\n    cursor: pointer;\r\n    width: 90px;\r\n    height: 35px;\r\n    border: 0px;\r\n    margin: 0px;\r\n    transition: 0.3s;\r\n    padding: 0px;\r\n    &:hover{\r\n        background-color: rgba(21, 94, 197, 0.11);\r\n    }\r\n}\r\n.T{\r\n    position: absolute;\r\n    top: 25px;\r\n    left: 1300px;\r\n    cursor: pointer;\r\n}\r\n.eRror{\r\n    position: absolute;\r\n    top: 70px;\r\n}\r\n</style>"],"names":["_sfc_main","datys","text","editor","url","params","teams","sect","headers","priv","useFetch","r","user","import_data","body","data","error","createError","act","id","list","block","a","name","outputData","_hoisted_2","_createElementVNode","$data","_normalizeClass","$options","_cache","$event","args"],"mappings":"+oBAqCA,MAAAA,EAAA,CAEA,OAAA,wCAMI,OAAA,oCAEA,OAAA,CAAA,CAAA,GAAA,OAAA,KAAA,YAAA,KAAA,CAAA,KAAA,EAAA,EAAA,EACA,QAAA,OAAA,kBAIJ,EACA,SAAA,IAAA,CAEA,CACA,CAAA,EACA,SAAAC,EAAAC,EAAA,CACIC,EAAA,OAAA,OAAA,CAAA,KAAA,cACA,OAAA,CAAA,CAAA,GAAA,OAAA,KAAA,YAAA,KAAA,CAAA,KAAAD,CAAA,EAAA,EACA,QAAA,OAAA,CAAA,CAEJ,oBAEQ,MAAAE,EAAA,IAAA,oDAER,EAEAC,EAAA,CACI,QAAAC,EAAA,eACA,WAAAC,EAAA,eACJ,EACA,OAAA,KAAAF,CAAA,4CAGA,MAAAG,EAAA,CACI,cAAA,UAAAC,EAAA,MACA,eAAA,4CAEJ,EAGA,MAAAC,EAAAN,EAAA,cAEI,QAAAI,CACJ,EAAA,aAAA,EAAA,KAAAG,GAAA,CAAAV,EAAAU,EAAA,KAAA,MAAA,KAAA,QAAA,OAAA,CAAA,CAAA,CACI,CAEJ,MAAA,CAAA,OAAAR,EAAA,KAAAM,EAAA,MAAAH,EAAA,KAAAM,EAAA,KAAAL,EAAA,YAAAM,CAAA,CACA,EACA,MAAA,CACI,MAAA,8BAEA,KAAA,iBAEA,OAAA,GACA,WAAA,0HAIA,MAAA,YAEA,CACJ,EAGA,QAAA,eAEQ,MAAAT,EAAA,IAAA,sDAER,EAEAI,EAAA,CACI,cAAA,UAAA,KAAA,KAAA,MACA,eAAA,4CAEJ,EAEA,IAAAM,EAAA,wBAEI,QAAA,KAAA,MAAA,cACJ,EACG,KAAA,CAAA,KAAAC,EAAA,MAAAC,CAAA,EAAA,MAAAN,EAAAN,EAAA,eAEC,QAAAI,wBAEJ,EAAA,aAAA,EACA,GAAA,CAAAO,EAAA,MACI,OAAAC,EAAA,MAAA,WAAA,CACA,IAAA,KAAA,MAAAC,EAAA,CAAA,WAAA,IAAA,cAAA,sBAAA,MAAA,GAAA,EAEA,IAAA,KAAA,MAAAA,EAAA,CAAA,WAAA,IAAA,cAAA,kBAAA,MAAA,GAAA,EAEA,IAAA,KAAA,MAAAA,EAAA,CAAA,WAAA,IAAA,cAAA,yIAAA,CAAA,EAEA,IAAA,KAAA,WAAA,KAAA,aACUA,EAAA,CAAA,WAAA,IAAA,cAAA,6HAAA,MAAA,EAAA,CAAA,CAEd,CAEA,EACI,QAAAC,EAAAC,EAAA,aAEA,KAAA,WAAAD,WAGC,KAAA,aAAAE,wBAGGC,IACI,KAAA,MAAA,qCAIR,QAAAC,EAAA,EAAAA,GAAAC,EAAA,OAAAD,4IASI,KAAA,OAAA,GACI,KAAA,OAOI,KAAA,MAAA,GACJ,KAAA,MAAA,6JAPI,KAAA,OAAA,KAAA,EAAA,KAAAE,GAAA,CACb,KAAA,KAAA,aAAA,KAAA,WAAA,KAAA,KAAAA,EAAA,KAAA,MAAA,KAAA,MAAA,CACH,CAAA,EAAA,MAAAR,GAAA,CACC,QAAA,IAAA,+GAAAA,CAAA,CACD,CAAA,GAOY,KAAA,MAAA,GACA,KAAA,MAAA,6GAGZ,CACA,CAAA,6BA/K6GS,EAAAC,EAAA,OAAA,KAAA,+DAAA,EAAA,uIAH3E,IAAA,EAAS,MAAAC,EAAA,iDAC7B,MAAAC,EAAA,CAAA,CAAA,MAAA,EAAA,EAAA,CAAA,MAAAD,EAAA,KAAA,CAAA,CAAA,WACY,OAAAE,EAAA,KAAa,QAAAC,EAAA,KAAAA,EAAA,GAAAC,GAAA,CAAAJ,EAAA,WAAA,EAAA,GAA+C,WAAAE,EAAA,WAAuB,KAAA,IAAY,UAAA,GAAgB,IAAA,6GACtF,MAAA,iBAC/B,YAAA,mCAAmE,IAAA,GAAU,KAAA,IAAY,UAAA,mDAC5F,MAAA,2EAAiE,KAAA,OAAa,MAAAF,EAAA,aAAqB,SAAA,qBACvF,IAAA,GAAY,QAAAG,EAAA,KAAAA,EAAA,GAAAC,GAAAJ,EAAA,OAAA,IAAsB,YAAA,mCAAmD,KAAA,uCAAiB,YAAA,GAAkB,UAAA,GAAgB,WAAA,GAAiB,WAAAE,EAAA,QAAoB,KAAA,EAAU,YAAA,IAAmB,UAAA,EAAe,IAAA,oDACnO,MAAA,qDAA2B,KAAA,OAAY,YAAA,0IACrC,QAAAC,EAAA,KAAAA,EAAA,GAAA,IAAAE,IAAAH,EAAA,WAAAA,EAAA,UAAA,GAAAG,CAAA,GAAkB,MAAA,wNACwE,MAAA"}