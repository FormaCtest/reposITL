import{_ as v,a as k}from"./list_section.b08b4afc.js";import{_ as y,a as w}from"./chain.e6a16fc3.js";import{_ as g}from"./changing_access.02a54b60.js";import{c as p,n as C}from"../server.mjs";import{openBlock as S,createElementBlock as x,withDirectives as u,createVNode as d,vShow as m,createElementVNode as n,normalizeClass as b,vModelText as T,unref as E}from"vue";import{a as j,u as D,b as A,c as f}from"./private.7b9915f8.js";import{u as R}from"./SectionStore.63b2f3c7.js";import{E as M}from"./editor.f8dcc403.js";import{_ as J}from"./_plugin-vue_export-helper.a1a6add7.js";import"./NavbarStore.1846ce18.js";import"#internal/nitro";import"vue-router";const L={setup(){const o=j(),t=D(),a=A(),s=R(),e=new M({holder:"editorjs",data:{time:1550476186479,blocks:[{id:"save",type:"paragraph",data:{text:""}}],version:"2.8.1"},onReady:()=>{c()},onChange:()=>{}});function r(l){e.blocks.render({time:1550476186479,blocks:[{id:"save",type:"paragraph",data:{text:l}}],version:"2.8.1"})}async function c(){const l=new URL("https://api.wiki.itl.systems/team/section/edit"),_={team_id:t.session_TeamID,section_id:s.current_section};Object.keys(_).forEach(i=>l.searchParams.append(i,_[i]));const h={Authorization:"Bearer "+o.token,"Content-Type":"application/json",Accept:"application/json"};await f(l,{method:"GET",headers:h},"$QN3ATJ9JDx").then(i=>{r(i.data.value.data.section.content)})}return{editor:e,priv:o,teams:t,user:a,sect:s,import_data:c}},data(){return{h_sec:this.sect.current_name,uSer:"",permission:"",parent:"",vis_select:!1,link_section:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0430\u0437\u0434\u0435\u043B",error:!1,block:!1,alert:"",vis_ch:!1}},methods:{async delet(){const o=new URL("https://api.wiki.itl.systems/team/section/delete"),t={Authorization:"Bearer "+this.priv.token,"Content-Type":"application/json",Accept:"application/json"};let a={section_id:this.parent,team_id:this.teams.session_TeamID};const{data:s,error:e}=await f(o,{method:"POST",headers:t,body:JSON.stringify(a)},"$ki7V0qjDDq");if(!s.value)switch(e.value.statusCode){case 401:throw p({statusCode:401,statusMessage:"the session is over",fatal:!0});case 500:throw p({statusCode:500,statusMessage:"invalid request",fatal:!0});case 400:throw p({statusCode:400,statusMessage:"\u0417\u0430\u043F\u0440\u043E\u0441\u0443 \u043D\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445"});case 429:throw this.priv.Delete_token,p({statusCode:400,statusMessage:"\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u043D\u043E\u0433\u043E \u0437\u0430\u043F\u0440\u043E\u0441\u043E\u0432",fatal:!0})}},get_per(o,t){this.uSer=t,this.permission=o},info(o){this.link_section=o},get_parent(o,t,a){if(a&&(this.block=!0),this.parent=o,typeof t=="object")for(let s=0;s<=t.length;s++)s===0?(this.link_section="",this.link_section+=t[s]):t[s]!==void 0&&(this.link_section+="/"+t[s]);else this.link_section=t},test_save(){this.h_sec!=""?this.block?(this.error=!0,this.alert="\u0412\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0439 \u0440\u0430\u0437\u0434\u0435\u043B \u043D\u0435 \u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D"):this.editor.save().then(o=>{this.sect.Edit_section(this.permission,this.uSer,o,this.h_sec,this.parent)}).catch(o=>{console.log("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F EditorJS: ",o)}):(this.error=!0,this.alert="\u0412\u044B \u043D\u0435 \u0432\u0432\u0435\u043B\u0438 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435!")}}},O=n("img",{src:w},null,-1),z=n("span",null,"\u041F\u043E\u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F",-1),B=[O,z],N=["value"],P=n("div",{id:"editorjs"},null,-1);function U(o,t,a,s,e,r){const c=v,l=k,_=y,h=g;return S(),x("div",null,[u(d(c,{top:0,alert:e.alert},null,8,["alert"]),[[m,e.error]]),n("div",{class:b([{heads:!0},{eRror:e.error}])},[u(d(l,{onList:r.info,onClick:t[0]||(t[0]=i=>{e.vis_select=!1}),onSelected:r.get_parent,left:230,left_arrw:20,top:130},null,8,["onList","onSelected"]),[[m,e.vis_select]]),n("div",{onClick:t[1]||(t[1]=i=>e.vis_ch=!e.vis_ch),class:"chg"},B),u(d(_,{type_entity:2,id_entity:s.sect.current_section,top:60,left:500,left_arrw:60},null,8,["id_entity"]),[[m,e.vis_ch]]),n("div",{class:"RR liz",onClick:t[2]||(t[2]=i=>{e.vis_select=!e.vis_select})},[n("input",{type:"text",value:e.link_section,readonly:""},null,8,N)]),d(h,{del:!0,onClick:t[3]||(t[3]=i=>e.vis_ch=!1),type_entity:2,id_entity:s.sect.current_section,text:"\u0414\u043E\u0441\u0442\u0443\u043F",width_input:80,width_img:14,height_img:15,onFor_whom:r.get_per,left:5,left_window:430,left_arrw:5,top:18},null,8,["id_entity","onFor_whom"]),u(n("input",{class:"HH","onUpdate:modelValue":t[4]||(t[4]=i=>e.h_sec=i),type:"text",placeholder:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A \u0440\u0430\u0437\u0434\u0435\u043B\u0430"},null,512),[[T,e.h_sec]]),n("button",{onClick:t[5]||(t[5]=(...i)=>r.test_save&&r.test_save(...i)),class:"OP"},"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0440\u0430\u0437\u0434\u0435\u043B"),n("button",{onClick:t[6]||(t[6]=i=>E(C)("/"+s.teams.session_TeamCode+".itl.wiki/section/"+s.sect.current_section)),class:"OT"},"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C"),P],2)])}const $=J(L,[["render",U]]);export{$ as default};
//# sourceMappingURL=edit.c12994d5.js.map
