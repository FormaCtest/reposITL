import{_ as b,a as w}from"./list_section.b08b4afc.js";import{_ as C,a as T}from"./chain.e6a16fc3.js";import{_ as x}from"./changing_access.02a54b60.js";import{_ as S,a as j,b as A}from"./EL.03916df4.js";import{n as u}from"../server.mjs";import{openBlock as c,createElementBlock as f,withDirectives as v,createVNode as k,vShow as B,createElementVNode as o,normalizeClass as E,createBlock as p,createCommentVNode as _,vModelText as L,unref as R}from"vue";import{a as U,u as H,b as N,c as g}from"./private.7b9915f8.js";import{u as V}from"./SectionStore.63b2f3c7.js";import{u as z}from"./ArticleStore.7b5f5aed.js";import{E as J}from"./editor.f8dcc403.js";import{H as O,L as P,I as q,Q as D,C as F,D as M,R as Q,T as W,W as G,a as I}from"./bundle.b38a729e.js";import{_ as X}from"./_plugin-vue_export-helper.a1a6add7.js";import"./NavbarStore.1846ce18.js";import"#internal/nitro";import"vue-router";const K={setup(){const n=V(),e=U(),i=H(),t=N(),s=z();return{editor:new J({tools:{header:{class:O,inlineToolbar:["link"]},list:{class:P,inlineToolbar:!0},image:{class:q},quote:{class:D},code:{class:F},delimiter:{class:M},raw:{class:Q},table:{class:W},warning:{class:G},checklist:{class:I}},holder:"editorjs"}),priv:e,teams:i,user:t,sect:n,article:s}},data(){return{tag:!1,errors:!1,alert:"",h_name:"",link_section:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0430\u0437\u0434\u0435\u043B",vis_list:!1,parent:"",act:[],check_pub:!1,vis_sh:!1,additionally:!1}},methods:{pub(n){this.check_pub=n},save_act(n,e){if(typeof e!="object")this.act=[{user_id:e,permission:n}];else for(let i=0;i<=e.length-1;i++)this.act.push({user_id:e[i].id,permission:n})},get_parent(n,e){if(this.parent=n,typeof e=="object")for(let i=0;i<=e.length-1;i++)i===0?(this.link_section="",this.link_section+=e[i]):e[i]!==void 0&&(this.link_section+="/"+e[i]);else this.link_section=e},add_content_blocks(n){var e=n;for(let t=0;t<=e.length-1;t++)switch(e[t].type){case"paragraph":e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.text;break;case"header":e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.text+"/&23948"+e[t].data.level;break;case"list":e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.style+"/&23948"+e[t].data.items.join("/&92834");break;case"quote":e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.text+"/&23948"+e[t].data.caption+"/&23948"+e[t].data.alignment;break;case"code":e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.code;break;case"delimiter":e[t].name=e[t].type+"_"+t;break;case"raw":e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.html;break;case"table":e[t].name=e[t].type+"_"+t;var i="";for(let s=0;s<=e[t].data.content.length-1;s++)i+=e[t].data.content[s].join("/&92834"),e[t].data.content.length-2>=s&&(i+="/&22903");e[t].content=e[t].data.withHeadings+"/&23948"+i;break;case"warning":e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.title+"/&23948"+e[t].data.message;break;case"checklist":e[t].name=e[t].type+"_"+t;var i="";for(let s=0;s<=e[t].data.items.length-1;s++)i+=e[t].data.items[s].text+"/&92834"+e[t].data.items[s].checked,e[t].data.items.length-2>=s&&(i+="/&23948");e[t].content=i;break}return e},async test_save(n){this.h_name!==""&&this.parent!=""?this.editor.save().then(e=>{e.blocks.length===0&&(this.errors=!0,this.alert="\u0441\u043E\u0434\u0435\u0440\u0436\u0430\u043D\u0438\u0435 \u0441\u0442\u0430\u0442\u044C\u0438 \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u0430");var i=this.add_content_blocks(e.blocks);const t=new URL("https://api.wiki.itl.systems/team/article/add"),s={Authorization:"Bearer "+this.priv.token,"Content-Type":"application/json",Accept:"application/json"};let a={team_id:this.teams.session_TeamID,section_id:this.parent,action:n,name:this.h_name,tabs:{...i}};this.act.length>=1&&(a.abilities={...this.act}),g(t,{method:"POST",headers:s,body:JSON.stringify(a)},"$R3EVz4uCqU").then(r=>{if(n===3){if(this.article.use_article(r.data.value.data.article.name,r.data.value.data.article.id),this.check_pub){const d=new URL("https://api.wiki.itl.systems/team/article/mode"),m={Authorization:"Bearer "+this.priv.token,"Content-Type":"application/json",Accept:"application/json"};let h={team_id:this.teams.session_TeamID,article_id:this.article.article_id,public:1};g(d,{method:"POST",headers:m,body:JSON.stringify(h)},"$ihXDB1iGiP")}u("/"+this.teams.session_TeamCode+".itl.wiki/section/"+this.sect.current_section+"/items/"+this.article.article_id)}else r.error.value===null&&u("/"+this.teams.session_TeamCode+".itl.wiki/")})}).catch(e=>{console.log("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F: ",e)}):(this.alert="\u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435/\u043F\u0443\u0442\u044C/\u0441\u043E\u0434\u0435\u0440\u0436\u0430\u043D\u0438\u0435 \u0441\u0442\u0430\u0442\u044C\u0438 \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B",this.errors=!0)}}},Y=["value"],Z=o("img",{src:j},null,-1),$=o("span",null,"\u0422\u0435\u0433\u0438",-1),ee=[Z,$],te=o("img",{src:A},null,-1),se=[te],ie=o("img",{src:T},null,-1),oe=o("span",null,"\u041F\u043E\u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F",-1),ne=[ie,oe],ae=o("div",{id:"editorjs"},null,-1),le={key:3},re=o("div",{class:"are"},null,-1),ce={class:"additionally"},_e=o("span",null,"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0447\u0435\u0440\u043D\u043E\u0432\u0438\u043A",-1),de=[_e];function me(n,e,i,t,s,a){const r=b,d=C,m=w,h=x,y=S;return c(),f("div",null,[v(k(r,{top:0,alert:s.alert},null,8,["alert"]),[[B,s.errors]]),o("div",{class:E([{head:!0},{errors:s.errors}])},[s.vis_sh?(c(),p(d,{key:0,onCheck:a.pub,top:50,left:500,left_arrw:40},null,8,["onCheck"])):_("",!0),s.vis_list?(c(),p(m,{key:1,onSelected:a.get_parent,top:140,left:230},null,8,["onSelected"])):_("",!0),o("input",{onClick:e[0]||(e[0]=l=>{s.vis_list=!s.vis_list,s.tag=!1,s.vis_sh=!1}),class:"r",type:"text",value:s.link_section,readonly:""},null,8,Y),v(o("input",{maxlength:"25","onUpdate:modelValue":e[1]||(e[1]=l=>s.h_name=l),class:"HJU",type:"text",placeholder:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A \u0441\u0442\u0430\u0442\u044C\u0438"},null,512),[[L,s.h_name]]),k(h,{onClick:e[2]||(e[2]=l=>{s.vis_sh=!1,s.tag=!1,s.vis_list=!1}),width_input:80,width_img:15,height_img:16,left_arrw:15,left_window:420,onFor_whom:a.save_act,left:0,top:8,text:"\u0434\u043E\u0441\u0442\u0443\u043F"},null,8,["onFor_whom"]),o("div",{onClick:e[3]||(e[3]=l=>{s.tag=!s.tag,s.vis_list=!1,s.vis_sh=!1}),class:"tag"},ee),s.tag?(c(),p(y,{key:2,top:70,left:190,left_arrw:105})):_("",!0),o("button",{onClick:e[4]||(e[4]=l=>a.test_save(t.teams.role==="user"?2:3)),class:"op"},"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C"),o("button",{onClick:e[5]||(e[5]=l=>R(u)("/"+t.teams.session_TeamCode+".itl.wiki/")),class:"ot"},"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C"),o("div",{onClick:e[6]||(e[6]=l=>s.additionally=!s.additionally),class:"t"},se),o("div",{onClick:e[7]||(e[7]=l=>{s.vis_sh=!s.vis_sh,s.tag=!1,s.vis_list=!1}),class:"kou"},ne),ae,s.additionally?(c(),f("div",le,[re,o("div",ce,[o("div",{class:"lik",onClick:e[8]||(e[8]=l=>a.test_save(1))},de)])])):_("",!0)],2)])}const Ae=X(K,[["render",me]]);export{Ae as default};
//# sourceMappingURL=add.29b23ff9.js.map
