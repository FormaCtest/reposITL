import{_ as D,a as I}from"./list_section.e0adecd0.js";import{_ as V,a as q}from"./chain.0fca7cf4.js";import{_ as F}from"./changing_access.27dfb36f.js";import{_ as G,a as Q,b as W}from"./EL.46b50029.js";import{a as K,m as w,b as R,e as o,w as B,k as M,j as E,f as X,c as g,h as y,v as Z,u as Y,o as f}from"./entry.19428e20.js";import{u as $,d as ee,a as te,b as m}from"./private.d82c0789.js";import{u as ie}from"./SectionStore.763b80b6.js";import{u as se}from"./ArticleStore.89b32673.js";import{E as ae}from"./editor.135d3e60.js";import{H as ne,L as oe,I as le,Q as re,C as ce,D as de,R as _e,T as pe,W as he,a as me}from"./bundle.f96f1759.js";import"./NavbarStore.7e812d0d.js";const ue={setup(){const l=ie(),e=$(),s=ee(),t=te(),i=se(),d=new ae({tools:{header:{class:ne,inlineToolbar:["link"]},list:{class:oe,inlineToolbar:!0},image:{class:le},quote:{class:re},code:{class:ce},delimiter:{class:de},raw:{class:_e},table:{class:pe},warning:{class:he},checklist:{class:me}},holder:"editorjsj",onReady:()=>{_()},onChange:()=>{}});async function _(){const a=new URL("https://api.wiki.itl.systems/team/article/edit"),r={team_id:s.session_TeamID,article_id:i.article_id};Object.keys(r).forEach(c=>a.searchParams.append(c,r[c]));const p={Authorization:"Bearer "+e.token,"Content-Type":"application/json",Accept:"application/json"};await m(a,{method:"GET",headers:p},"$c35k5a8mX1").then(c=>{c.data.value.data.article.tabs.length!==0&&u(c.data.value.data.article.tabs)})}function u(a){var r=[],p="/&23948",c="/&22903",k="/&92834";for(let n=0;n<=a.length-1;n++)switch(a[n].type){case"paragraph":r.push({id:a[n].id,type:"paragraph",data:{text:a[n].content}});break;case"header":var T=a[n].content.split(p),L=T[0],U=T[1];r.push({id:a[n].id,type:"header",data:{text:L,level:U}});break;case"list":var C=a[n].content.split(p),P=C[0],H=C[1].split(k);r.push({id:a[n].id,type:"list",data:{style:P,items:H}});break;case"quote":var b=a[n].content.split(p),J=b[0],N=b[1],z=b[2];r.push({id:a[n].id,type:"quote",data:{text:J,caption:N,alignment:z}});break;case"code":r.push({id:a[n].id,type:"code",data:{code:a[n].content}});break;case"delimiter":r.push({id:a[n].id,type:"delimiter",data:{}});break;case"raw":r.push({id:a[n].id,type:"raw",data:{html:a[n].content}});break;case"table":var x=a[n].content.split(p),v=x[1].split(c);for(let h=0;h<=v.length-1;h++)v[h]=v[h].split(k);r.push({id:a[n].id,type:"table",data:{withHeadings:x[0],content:v}});break;case"warning":var j=a[n].content.split(p);r.push({id:a[n].id,type:"warning",data:{title:j[0],message:j[1]}});break;case"checklist":var S=a[n].content.split(p),A=[];for(let h=0;h<=S.length-1;h++){let O=S[h].split(k);A.push({text:O[0],checked:O[1]})}r.push({id:a[n].id,type:"checklist",data:{items:A}});break}d.blocks.render({time:1550476186479,blocks:r,version:"2.8.1"})}return{editor:d,priv:e,teams:s,user:t,sect:l,article:i}},created(){setTimeout(()=>{this.info_article().then(()=>{this.h_name=this.article_data.info_public.article.name,this.link_section=this.article_data.info_public.article.section.name,this.parent=this.article_data.info_public.article.section.id})},500)},data(){return{tggg:!1,errory:!1,alert:"",h_name:"",link_section:"",vis_list:!1,parent:!1,act:[],check_pub:!1,vis_sh:!1,additional:!1,article_data:[]}},methods:{async unart(){const l=new URL("https://api.wiki.itl.systems/team/article/delete"),e={Authorization:"Bearer "+this.priv.token,"Content-Type":"application/json",Accept:"application/json"};let s={article_id:this.article.article_id,team_id:this.teams.session_TeamID};m(l,{method:"POST",headers:e,body:JSON.stringify(s)},"$0wZKvjJs7V").then(()=>{this.article.exit_article(),window.location.href="/"+this.teams.session_TeamCode+".itl.wiki"})},async info_article(){const l=new URL("https://api.wiki.itl.systems/team/article/edit"),e=new URL("https://api.wiki.itl.systems/team/article"),s={team_id:this.teams.session_TeamID,article_id:this.article.article_id};Object.keys(s).forEach(_=>{l.searchParams.append(_,s[_]),e.searchParams.append(_,s[_])});const t={Authorization:"Bearer "+this.priv.token,"Content-Type":"application/json",Accept:"application/json"},{data:i}=await m(l,{method:"GET",headers:t},"$Pt2EBK6IrN"),{data:d}=await m(e,{method:"GET",headers:t},"$besF5W1eeH");this.article_data={info_edit:i.value.data,info_public:d.value.data}},pub(l){this.check_pub=l},save_act(l,e){if(typeof e!="object")this.act=[{user_id:e,permission:l}];else for(let s=0;s<=e.length-1;s++)this.act.push({user_id:e[s].id,permission:l})},get_parent(l,e){if(this.parent=l,typeof e=="object")for(let s=0;s<=e.length-1;s++)s===0?(this.link_section="",this.link_section+=e[s]):e[s]!==void 0&&(this.link_section+="/"+e[s]);else this.link_section=e},add_content_blocks(l){var e=l;for(let t=0;t<=e.length-1;t++)switch(e[t].type){case"paragraph":typeof e[t].id!="number"&&delete e[t].id,e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.text;break;case"header":typeof e[t].id!="number"&&delete e[t].id,e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.text+"/&23948"+e[t].data.level;break;case"list":typeof e[t].id!="number"&&delete e[t].id,e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.style+"/&23948"+e[t].data.items.join("/&92834");break;case"quote":typeof e[t].id!="number"&&delete e[t].id,e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.text+"/&23948"+e[t].data.caption+"/&23948"+e[t].data.alignment;break;case"code":typeof e[t].id!="number"&&delete e[t].id,e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.code;break;case"delimiter":typeof e[t].id!="number"&&delete e[t].id,e[t].name=e[t].type+"_"+t;break;case"raw":typeof e[t].id!="number"&&delete e[t].id,e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.html;break;case"table":typeof e[t].id!="number"&&delete e[t].id,e[t].name=e[t].type+"_"+t;var s="";for(let i=0;i<=e[t].data.content.length-1;i++)s+=e[t].data.content[i].join("/&92834"),e[t].data.content.length-2>=i&&(s+="/&22903");e[t].content=e[t].data.withHeadings+"/&23948"+s;break;case"warning":typeof e[t].id!="number"&&delete e[t].id,e[t].name=e[t].type+"_"+t,e[t].content=e[t].data.title+"/&23948"+e[t].data.message;break;case"checklist":typeof e[t].id!="number"&&delete e[t].id,e[t].name=e[t].type+"_"+t;var s="";for(let i=0;i<=e[t].data.items.length-1;i++)s+=e[t].data.items[i].text+"/&92834"+e[t].data.items[i].checked,e[t].data.items.length-2>=i&&(s+="/&23948");e[t].content=s;break}return e},async test_save(l){this.h_name!==""&&this.parent!=""?this.editor.save().then(e=>{e.blocks.length===0&&(this.errory=!0,this.alert="\u0441\u043E\u0434\u0435\u0440\u0436\u0430\u043D\u0438\u0435 \u0441\u0442\u0430\u0442\u044C\u0438 \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u0430");var s=this.add_content_blocks(e.blocks);const t=new URL("https://api.wiki.itl.systems/team/article/edit"),i={Authorization:"Bearer "+this.priv.token,"Content-Type":"application/json",Accept:"application/json"};let d={team_id:this.teams.session_TeamID,article_id:this.article.article_id,section_id:this.parent,action:l,name:this.h_name,tabs:{...s}};this.act&&(d.abilities={...this.act}),m(t,{method:"POST",headers:i,body:JSON.stringify(d)},"$iOyhUgbUA8").then(_=>{if(l===3){if(this.article.use_article(this.h_name,this.article.article_id),this.check_pub){const u=new URL("https://api.wiki.itl.systems/team/article/mode"),a={Authorization:"Bearer "+this.priv.token,"Content-Type":"application/json",Accept:"application/json"};let r={team_id:this.teams.session_TeamID,article_id:this.article.article_id,public:1};m(u,{method:"POST",headers:a,body:JSON.stringify(r)},"$kadanQJrSy")}w("/"+this.teams.session_TeamCode+".itl.wiki/my_works/"+this.article.article_id+"/")}else _.error.value===null&&w("/"+this.teams.session_TeamCode+".itl.wiki/")})}).catch(e=>{console.log("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F: ",e)}):(this.alert="\u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435/\u043F\u0443\u0442\u044C/\u0441\u043E\u0434\u0435\u0440\u0436\u0430\u043D\u0438\u0435 \u0441\u0442\u0430\u0442\u044C\u0438 \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B",this.errory=!0)}}},fe=["value"],ve=o("img",{src:G},null,-1),ye=o("span",null,"\u0422\u0435\u0433\u0438",-1),ke=[ve,ye],be=o("img",{src:Q},null,-1),ge=[be],we=o("img",{src:q},null,-1),Te=o("span",null,"\u041F\u043E\u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F",-1),Ce=[we,Te],xe=o("div",{id:"editorjsj"},null,-1),je={key:0},Se=o("div",{class:"era"},null,-1),Ae={class:"additional"},Oe=o("span",null,"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0447\u0435\u0440\u043D\u043E\u0432\u0438\u043A",-1),Re=[Oe],Be={class:"additionalOO"},Ee=o("span",null,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",-1),Le=[Ee];function Ue(l,e,s,t,i,d){const _=D,u=V,a=I,r=F,p=W;return f(),R("div",null,[o("div",null,[B(E(_,{top:0,alert:i.alert},null,8,["alert"]),[[M,i.errory]]),o("div",{class:X([{hid:!0},{errory:i.errory}])},[i.vis_sh?(f(),g(u,{key:0,onCheck:d.pub,top:50,left:500,left_arrw:40},null,8,["onCheck"])):y("",!0),i.vis_list?(f(),g(a,{key:1,onSelected:d.get_parent,top:140,left:230},null,8,["onSelected"])):y("",!0),o("input",{onClick:e[0]||(e[0]=c=>{i.vis_list=!i.vis_list,i.tggg=!1,i.vis_sh=!1}),class:"r",type:"text",value:i.link_section,readonly:""},null,8,fe),B(o("input",{maxlength:"25","onUpdate:modelValue":e[1]||(e[1]=c=>i.h_name=c),class:"HJ",type:"text",placeholder:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A \u0441\u0442\u0430\u0442\u044C\u0438"},null,512),[[Z,i.h_name]]),E(r,{onClick:e[2]||(e[2]=c=>{i.vis_sh=!1,i.tggg=!1,i.vis_list=!1}),width_input:80,width_img:15,height_img:16,left_arrw:15,left_window:420,onFor_whom:d.save_act,type_entity:2,id_entity:t.article.article_id,left:0,top:8,text:"\u0434\u043E\u0441\u0442\u0443\u043F"},null,8,["onFor_whom","id_entity"]),o("div",{onClick:e[3]||(e[3]=c=>{i.tggg=!i.tggg,i.vis_list=!1,i.vis_sh=!1}),class:"tggg"},ke),i.tggg?(f(),g(p,{key:2,top:70,left:190,left_arrw:105})):y("",!0),o("button",{onClick:e[4]||(e[4]=c=>d.test_save(3)),class:"oppo"},"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C"),o("button",{onClick:e[5]||(e[5]=c=>Y(w)("/"+t.teams.session_TeamCode+".itl.wiki/")),class:"ot"},"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C"),o("div",{onClick:e[6]||(e[6]=c=>i.additional=!i.additional),class:"TTTR"},ge),o("div",{onClick:e[7]||(e[7]=c=>{i.vis_sh=!i.vis_sh,i.tggg=!1,i.vis_list=!1}),class:"kay"},Ce)],2),xe,i.additional?(f(),R("div",je,[Se,o("div",Ae,[o("div",{class:"lik",onClick:e[8]||(e[8]=c=>d.test_save(2))},Re)]),o("div",Be,[o("div",{class:"lik",onClick:e[9]||(e[9]=c=>d.unart())},Le)])])):y("",!0)])])}const Qe=K(ue,[["render",Ue]]);export{Qe as default};
